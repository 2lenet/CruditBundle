<div class="dropdown">
    <button
        id="dropdown-actions-{{ action.label|replace({'.': '-'}) }}"
        class="btn btn-primary dropdown-toggle py-1"
        data-bs-toggle="dropdown"
    >
        {{ dropdown_action.label|trans(domain=view.config.translation_domain) }}
    </button>
    <ul
        class="dropdown-menu dropdown-menu-end"
        aria-labelledby="#dropdown-actions-{{ dropdown_action.label|replace({'.': '-'}) }}"
    >
        {% for group_name, group in dropdown_action.actions %}
            {% if crudit_is_dropdown_group_name(group_name) %}
                <li><h6 class="dropdown-header">{{ group_name|trans(domain=view.config.translation_domain) }}</h6></li>
            {% elseif loop.index0 != 0 and not crudit_is_dropdown_group_name(group_name) %}
                <li><hr class="dropdown-divider"></li>
            {% endif %}

            {% for action in group %}
                {% set params = action.path.params %}
                {% if view.data.resource and action.setResource is defined%}
                    {% do action.setResource(view.data.resource) %}
                {% endif %}

                {% set id = app.request.attributes.get('id') %}
                {% if id %}
                    {% set params = action.path.params|merge({id: id}) %}
                {% endif %}

                {% if action.modal %}
                    {% include action.modal with {action: action, id: 'modal_' ~ action.id, params: params} %}
                {% endif %}

                {% set disabled = action.disabled or not
                    ((action.path.role is null or is_granted(action.path.role, view.data.resource))
                    and (action.role is null or is_granted(action.role, view.data.resource)))
                %}

                {% if not (disabled and crudit_hide_if_disabled(action)) %}
                    <li>
                        <a
                            class="{{ action.cssClass ?? 'dropdown-item' }} {% if disabled %}disabled{% endif %}"
                            {% if action.modal %}
                                data-bs-toggle="modal" data-bs-target="#modal_{{ action.id }}"
                            {% elseif not action.disabled %}
                                href="{{ action.url ?? path(action.path.route, params) }}"
                            {% endif %}
                        >
                            {% if action.icon %}<i class="{{ action.icon.cssClass }}"></i>{% endif %}
                            {% if not action.hideLabel %}{{ action.label|trans(domain=view.config.translation_domain) }}{% endif %}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </ul>
</div>
